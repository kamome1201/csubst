![](logo/logo_csubst.svg)

## Overview
**csubst** is a tool for molecular convergence detection in codon sequences.

## Input files
**csubst** takes as inputs a rooted tree, a multiple sequence alignment, and miscellaneous files including reconstructed ancestral sequences that are generated by [IQ-TREE](http://www.iqtree.org/) (version 2.0.0 or later).

## Dependency
**csubst** runs on python 3.5+ and depends on the following python packages. `pip install` will automatically install them; See below.
* [python 3](https://www.python.org/)
* [ete3](https://github.com/etetoolkit/ete)
* [numpy](https://github.com/numpy/numpy)
* [scipy](https://www.scipy.org/)
* [pandas](https://github.com/pandas-dev/pandas)
* [joblib](https://github.com/joblib/joblib)
* [cython](https://cython.org/)
* [pyvolve](https://github.com/sjspielman/pyvolve) (Optional: required for `csubst simulate`)

## Installation
**csubst** can be installed by the following command. **IQ-TREE** should also be installed in the same environment; See [here](http://www.iqtree.org/doc/Quickstart#installation) for instruction.
```
# Installation with pip
pip install git+https://github.com/kfuku52/csubst

# Check the complete set of options
csubst -h 
```

## Getting started
**csubst** contains datasets that can be used for test runs with the commands below.
See [csubst wiki](https://github.com/kfuku52/csubst/wiki) for details. Specification of the IQ-TREE's substitution models is described [here](http://www.iqtree.org/doc/Substitution-Models).

```
# Generate a directory and enter
mkdir ./PGK
cd ./PGK

# Generate a test dataset
csubst dataset --name PGK

# Run IQ-TREE (version >=2.0.0) to get required files 
# (.state, .rate, .log, .iqtree and .treefile)
iqtree \
-s alignment.fa \
-te tree.nwk \
-m ECMK07+F+R4 \
--seqtype CODON1 \
--threads-max 4 \
--ancestral \
--rate \
--redo

# Run csubst analyze
csubst analyze \
--codon_table 1 \
--alignment_file alignment.fa \
--rooted_tree_file tree.nwk \
--max_arity 2 \
--nslots 4
```

## Simulation of molecular convergence
**csubst** can simulate codon evolution along the rooted tree in `tree.nwk` with convergence in the taxa listed in `foreground.txt`. Parameters such as codon frequencies are estimated from `alignment.fa`. Please make sure to install **pyvolve** to use this function.
```
# Run csubst simulate
csubst simulate \
--codon_table 1 \
--alignment_file alignment.fa \
--rooted_tree_file tree.nwk \
--infile_type iqtree \
--foreground foreground.txt \
--fg_stem_only yes \
--num_simulated_site 5000 \
--convergence_intensity_factor 100 \
--background_omega 0.1 \
--foreground_omega 0.1 \
--tree_scaling_factor 5 \
--convergent_amino_acids random1 \
--num_partition 100

# Run IQ-TREE
iqtree \
-s simulate.fa \
-te tree.nwk \
-m ECMK07 \
--seqtype CODON1 \
--threads-max 4 \
--ancestral \
--rate \
--redo

# Run csubst analyze
csubst analyze \
--codon_table 1 \
--alignment_file simulate.fa \
--rooted_tree_file tree.nwk \
--infile_type iqtree \
--max_arity 2 \
--foreground foreground.txt \
--fg_stem_only yes \
--force_exhaustive yes \
--asrv each \
--nslots 4

```


## Licensing
**csubst** is BSD-licensed (3 clause). See [LICENSE](LICENSE) for details.