![](logo/logo_csubst_large.svg)

## Overview
**csubst** is a tool for analyzing combinatorial substitutions of codon sequences in phylogenetic trees. Main features include:

- Accurate detection of the rate of molecular convergence with null expectation obtained by:
    - Among-site substitution randomization
    - Empirical codon substitution model
    - Mechanistic codon substitution model
- Analysis of higher-order convergence involving more than two branches
- Simulated sequence evolution under specified scenarios of convergent evolution
- Flexible specification of "foreground" lineages and its comparison with neighboring branches

## Input files
**csubst** takes as inputs a rooted tree, a multiple sequence alignment, and miscellaneous files including reconstructed ancestral sequences that are generated by [IQ-TREE](http://www.iqtree.org/) (version 2.0.0 or later).

## Dependency
**csubst** runs on python 3 (tested with >3.5.0) and depends on the following python packages. **csubst** installation with `pip install` will automatically install them except for **pyvolve** and **matplotlib**.
* [python 3](https://www.python.org/)
* [ete3](https://github.com/etetoolkit/ete)
* [numpy](https://github.com/numpy/numpy)
* [scipy](https://www.scipy.org/)
* [pandas](https://github.com/pandas-dev/pandas)
* [joblib](https://github.com/joblib/joblib)
* [cython](https://cython.org/)
* [pyvolve](https://github.com/sjspielman/pyvolve) (Optional: required for `csubst simulate`)
* [matplotlib](https://matplotlib.org/3.1.1/index.html)

## Installation
**csubst** can be installed by the following command. **IQ-TREE** should also be installed in the same environment; See [here](http://www.iqtree.org/doc/Quickstart#installation) for instruction.
```
# Installation with pip
pip install numpy cython # NumPy and Cython should be available upon csubst installation
pip install git+https://github.com/kfuku52/csubst

# Check the complete set of options
csubst -h 
```

## Getting started
**csubst** contains datasets that can be used for test runs with the commands below.
See [csubst wiki](https://github.com/kfuku52/csubst/wiki) for details. Specification of the IQ-TREE's substitution models is described [here](http://www.iqtree.org/doc/Substitution-Models).

```
# Generate a directory and enter
mkdir ./PGK
cd ./PGK

# Generate a test dataset
csubst dataset --name PGK

# Run IQ-TREE (version >=2.0.0) to get required files 
# (.state, .rate, .log, .iqtree and .treefile)
iqtree \
-s alignment.fa \
-te tree.nwk \
-m ECMK07+F+R4 \
--seqtype CODON1 \
--threads-max 4 \
--ancestral \
--rate \
--redo

# Run csubst analyze
csubst analyze \
--alignment_file alignment.fa \
--rooted_tree_file tree.nwk \
--codon_table 1 \
--omega_method rec \
--foreground foreground.txt \
--force_exhaustive yes \
--max_arity 2 \
--nslots 4

```

## Licensing
**csubst** is BSD-licensed (3 clause). See [LICENSE](LICENSE) for details.